image: golang:1.14.2-stretch

stages:
  - build-recs
  - build-spotify
  - build-database-migrator
  - test

build-database-migrator:
  stage: build-database-migrator
  script:
    - go build -o database-migrator ./core/database-migrator/main.go

build-recs:
  stage: build-recs
  script:
    - go build -o recs-api ./services/recs-api/main.go
  only:
    changes:
      - "services/recs-api"

build-spotify:
  stage: build-spotify
  script:
    - go build -o spotify-poller ./services/spotify-poller/cmd/spotify-poller/main.go
  only:
    changes:
      - "services/spotify-api"

test:
  stage: test
  script:
    - make test